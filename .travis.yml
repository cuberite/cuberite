language: cpp
sudo: required

compiler:
- clang
- gcc

before_script:
- ulimit -c unlimited -S    #enable core dumps

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - gdb

script: ./CIbuild.sh

env:
  - TRAVIS_CUBERITE_BUILD_TYPE=RELEASE CUBERITE_PATH=./Cuberite
  - TRAVIS_CUBERITE_BUILD_TYPE=DEBUG   CUBERITE_PATH=./Cuberite_debug

notifications:
  email:
    on_success: change
    on_failure: always

after_failure:
- cat /proc/sys/kernel/core_pattern
- COREFILE=$(find Server -maxdepth 1 -name "core*" | head -n 1) # find core file
- echo $COREFILE
- if [[ -f "$COREFILE" ]]; then gdb -c "$COREFILE" Server/Cuberite* -ex "thread apply all bt" -ex "set pagination 0" -batch; fi
