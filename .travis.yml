language: cpp
sudo: false

# Use Linux by default
os: linux

matrix:
  include:
    # AppleClang
    # OSX workers are slower to start up.  Having these first in the build matrix makes travis faster overall.
    - os: osx
      compiler: clang
      env: &Release
        - TRAVIS_CUBERITE_BUILD_TYPE=RELEASE CUBERITE_PATH=./Cuberite
    - os: osx
      compiler: clang
      env: &Debug
        - TRAVIS_CUBERITE_BUILD_TYPE=DEBUG CUBERITE_PATH=./Cuberite_debug
    # Default clang
    - compiler: clang
      # Newer gcc needed for libstdc++
      addons: &gcc5
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
            - gcc-5
      env: *Release
    - compiler: clang
      addons: *gcc5
      env: *Debug
    # clang 3.6
    - compiler: clang
      addons: &clang36
        apt:
          sources:
            - llvm-toolchain-precise-3.6
            - ubuntu-toolchain-r-test
          packages:
            - clang++-3.6
            - clang-3.6
      before_install:
        - CC=clang-3.6;CXX=clang++-3.6
      env: *Release
    - compiler: clang
      addons: *clang36
      before_install:
        - CC=clang-3.6;CXX=clang++-3.6
      env: *Debug
    # gcc 5
    - compiler: gcc
      addons: *gcc5
      before_install:
        - CC=gcc-5;CXX=g++-5
      env: *Release
    - compiler: gcc
      addons: *gcc5
      before_install:
        - CC=gcc-5;CXX=g++-5
      env: *Debug

script: ./CIbuild.sh

notifications:
  email:
    on_success: change
    on_failure: always
branches:
  only:
    - coverity_scan
    - master
