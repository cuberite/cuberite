language: cpp
sudo: false

compiler:
- clang
- gcc

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - gdb

script: ./CIbuild.sh

env:
  - TRAVIS_CUBERITE_BUILD_TYPE=RELEASE CUBERITE_PATH=./Cuberite
  - TRAVIS_CUBERITE_BUILD_TYPE=DEBUG   CUBERITE_PATH=./Cuberite_debug

notifications:
  email:
    on_success: change
    on_failure: always
branches:
  only:
    - coverity_scan
    - master

after_failure:
- cat /proc/sys/kernel/core_pattern
- COREFILE=$(find Server -maxdepth 1 -name "core*" | head -n 1) # find core file
- echo $COREFILE # print path of core file
- echo `pwd` # print path of working directory
- if [[ -f "$COREFILE" ]]; then gdb -c "$COREFILE" $CUBERITE_PATH -ex "info threads" -ex "thread apply all bt" -ex "set pagination 0" -batch; fi
